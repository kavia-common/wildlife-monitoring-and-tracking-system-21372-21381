{"is_source_file": true, "format": "Python", "description": "This Python source file manages MongoDB database connection setup, configuration, index creation, and connection lifecycle for a wildlife monitoring system. It defines settings classes, global connection variables, and functions to initialize, get, and close database connections, along with index specifications for various collections.", "external_files": ["motor.motor_asyncio", "pydantic", "pydantic_settings"], "external_methods": ["AsyncIOMotorClient", "AsyncIOMotorDatabase", "AsyncIOMotorCollection", "Field", "SettingsConfigDict", "lru_cache", "BaseModel"], "published": ["get_database", "get_collection", "ensure_database", "close_database", "init_indexes", "DatabaseSettings", "COLLECTIONS"], "classes": [{"name": "DatabaseSettings", "description": "Holds MongoDB connection configuration loaded from environment variables, including URI and database name.", "methods": [{"name": "__init__", "description": "Initializes settings from environment variables, with configuration options."}]}, {"name": "IndexSpec", "description": "Represents an index specification for MongoDB, including fields, options like uniqueness, background creation, and type (2dsphere for geospatial indexes)."}], "methods": [{"name": "DatabaseSettings get_settings()", "description": "Returns cached instance of DatabaseSettings loaded from environment variables.", "scope": "", "scopeKind": ""}, {"name": "AsyncIOMotorDatabase get_database()", "description": "Returns the active MongoDB database instance; raises error if not initialized.", "scope": "", "scopeKind": ""}, {"name": "AsyncIOMotorCollection get_collection(name: str)", "description": "Returns a collection handle by name from the active database.", "scope": "", "scopeKind": ""}, {"name": "AsyncIOMotorDatabase ensure_database()", "description": "Initializes MongoDB connection if not already established, performs a ping to validate connectivity.", "scope": "", "scopeKind": ""}, {"name": "None close_database()", "description": "Closes the MongoDB client connection gracefully.", "scope": "", "scopeKind": ""}, {"name": "None _create_indexes_for_collection(name: str, specs: list[IndexSpec])", "description": "Creates indexes for a specific collection based on predefined specifications.", "scope": "", "scopeKind": ""}, {"name": "None init_indexes()", "description": "Ensures all required collection indexes are created; should be called at app startup.", "scope": "", "scopeKind": ""}], "calls": ["get_settings", "AsyncIOMotorClient", "get_collection", "_client.close", "index.create_index", "ensure_database", "_create_indexes_for_collection", "asyncio.gather"], "search-terms": ["MongoDB connection", "index creation", "AsyncIOMotorClient", "settings configuration", "geospatial indexes", "collections", "index specifications"], "state": 2, "file_id": 6, "knowledge_revision": 13, "git_revision": "", "ctags": [{"_type": "tag", "name": "COLLECTIONS", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^COLLECTIONS: Dict[str, list[IndexSpec]] = {$/", "language": "Python", "typeref": "typename:Dict[str, list[IndexSpec]]", "kind": "variable"}, {"_type": "tag", "name": "DatabaseSettings", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^class DatabaseSettings(BaseSettings):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "IndexSpec", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^class IndexSpec(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MONGODB_DB_NAME", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^    MONGODB_DB_NAME: str = Field(..., description=\"MongoDB database name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "DatabaseSettings", "scopeKind": "class"}, {"_type": "tag", "name": "MONGODB_URI", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^    MONGODB_URI: str = Field(..., description=\"MongoDB connection URI\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "DatabaseSettings", "scopeKind": "class"}, {"_type": "tag", "name": "_client", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^_client: Optional[AsyncIOMotorClient] = None$/", "language": "Python", "typeref": "typename:Optional[AsyncIOMotorClient]", "kind": "variable"}, {"_type": "tag", "name": "_create_indexes_for_collection", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^async def _create_indexes_for_collection(name: str, specs: list[IndexSpec]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(name: str, specs: list[IndexSpec])"}, {"_type": "tag", "name": "_db", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^_db: Optional[AsyncIOMotorDatabase] = None$/", "language": "Python", "typeref": "typename:Optional[AsyncIOMotorDatabase]", "kind": "variable"}, {"_type": "tag", "name": "background", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^    background: bool = True$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "IndexSpec", "scopeKind": "class"}, {"_type": "tag", "name": "close_database", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^async def close_database() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "ensure_database", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^async def ensure_database() -> AsyncIOMotorDatabase:$/", "language": "Python", "typeref": "typename:AsyncIOMotorDatabase", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_collection", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^def get_collection(name: str) -> AsyncIOMotorCollection:$/", "language": "Python", "typeref": "typename:AsyncIOMotorCollection", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "get_database", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^def get_database() -> AsyncIOMotorDatabase:$/", "language": "Python", "typeref": "typename:AsyncIOMotorDatabase", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_settings", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^def get_settings() -> DatabaseSettings:$/", "language": "Python", "typeref": "typename:DatabaseSettings", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "init_indexes", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^async def init_indexes() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "model_config", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^    model_config = SettingsConfigDict(env_file=\".env\", env_file_encoding=\"utf-8\", extra=\"ignore\"/", "language": "Python", "kind": "variable", "scope": "DatabaseSettings", "scopeKind": "class"}, {"_type": "tag", "name": "sparse", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^    sparse: bool = False$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "IndexSpec", "scopeKind": "class"}, {"_type": "tag", "name": "unique", "path": "/home/kavia/workspace/code-generation/wildlife-monitoring-and-tracking-system-21372-21381/wildlife_tracking_backend/src/db/connection.py", "pattern": "/^    unique: bool = False$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "IndexSpec", "scopeKind": "class"}], "hash": "2a6a0c609926871a292e7ab108013965", "format-version": 4, "code-base-name": "wildlife_tracking_backend", "filename": "wildlife_tracking_backend/src/db/connection.py", "fields": [{"name": "Dict[str, list[IndexSpec]] COLLECTIONS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str MONGODB_DB_NAME", "scope": "DatabaseSettings", "scopeKind": "class", "description": "unavailable"}, {"name": "str MONGODB_URI", "scope": "DatabaseSettings", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[AsyncIOMotorClient] _client", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[AsyncIOMotorDatabase] _db", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool background", "scope": "IndexSpec", "scopeKind": "class", "description": "unavailable"}, {"name": "model_config = SettingsConfigDict(env_file=\".env\", env_file_encoding=\"utf-8\", extra=\"ignore\"/", "scope": "DatabaseSettings", "scopeKind": "class", "description": "unavailable"}, {"name": "bool sparse", "scope": "IndexSpec", "scopeKind": "class", "description": "unavailable"}, {"name": "bool unique", "scope": "IndexSpec", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"13": ""}]}